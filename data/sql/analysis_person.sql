CREATE SCHEMA IF NOT EXISTS analysis;

INSERT INTO analysis.silver_person
SELECT
        TRY_CAST(STATE AS INTEGER) AS state,
        STATENAME AS state_name,
        TRY_CAST(ST_CASE AS INTEGER) AS st_case,
        TRY_CAST(VEH_NO AS INTEGER) AS veh_no,
        TRY_CAST(PER_NO AS INTEGER) AS per_no,
        TRY_CAST(VE_FORMS AS INTEGER) AS ve_forms,
        TRY_CAST(COUNTY AS INTEGER) AS county,
        TRY_CAST(MONTH AS INTEGER) AS month,
        MONTHNAME AS month_name,
        TRY_CAST(DAY AS INTEGER) AS day,
        DAYNAME AS day_name,
        TRY_CAST(HOUR AS INTEGER) AS hour,
        HOURNAME AS hour_name,
        TRY_CAST(MINUTE AS INTEGER) AS minute,
        MINUTENAME AS minute_name,
        TRY_CAST(HARM_EV AS INTEGER) AS harm_ev,
        HARM_EVNAME AS harm_ev_name,
        TRY_CAST(MAN_COLL AS INTEGER) AS man_coll,
        MAN_COLLNAME AS man_coll_name,
        TRY_CAST(SCH_BUS AS INTEGER) AS sch_bus,
        SCH_BUSNAME AS sch_bus_name,
        TRY_CAST(RUR_URB AS INTEGER) AS rur_urb,
        RUR_URBNAME AS rur_urb_name,
        TRY_CAST(FUNC_SYS AS INTEGER) AS func_sys,
        FUNC_SYSNAME AS func_sys_name,
        TRY_CAST(MOD_YEAR AS INTEGER) AS mod_year,
        MOD_YEARNAME AS mod_year_name,
        TRY_CAST(VPICMAKE AS INTEGER) AS vpicmake,
        VPICMAKENAME AS vpicmake_name,
        TRY_CAST(VPICMODEL AS INTEGER) AS vpicmodel,
        VPICMODELNAME AS vpicmodel_name,
        TRY_CAST(VPICBODYCLASS AS INTEGER) AS vpicbodyclass,
        VPICBODYCLASSNAME AS vpicbodyclass_name,
        TRY_CAST(MAKE AS INTEGER) AS make,
        MAKENAME AS make_name,
        TRY_CAST(BODY_TYP AS INTEGER) AS body_typ,
        BODY_TYPNAME AS body_typ_name,
        TRY_CAST(ICFINALBODY AS INTEGER) AS icfinalbody,
        ICFINALBODYNAME AS icfinalbody_name,
        TRY_CAST(GVWR_FROM AS INTEGER) AS gvwr_from,
        GVWR_FROMNAME AS gvwr_from_name,
        TRY_CAST(GVWR_TO AS INTEGER) AS gvwr_to,
        GVWR_TONAME AS gvwr_to_name,
        TRY_CAST(TOW_VEH AS INTEGER) AS tow_veh,
        TOW_VEHNAME AS tow_veh_name,
        TRY_CAST(SPEC_USE AS INTEGER) AS spec_use,
        SPEC_USENAME AS spec_use_name,
        TRY_CAST(EMER_USE AS INTEGER) AS emer_use,
        EMER_USENAME AS emer_use_name,
        TRY_CAST(ROLLOVER AS INTEGER) AS rollover,
        ROLLOVERNAME AS rollover_name,
        TRY_CAST(IMPACT1 AS INTEGER) AS impact1,
        IMPACT1NAME AS impact1_name,
        TRY_CAST(FIRE_EXP AS INTEGER) AS fire_exp,
        FIRE_EXPNAME AS fire_exp_name,
        MAK_MOD AS mak_mod,
        MAK_MODNAME AS mak_mod_name,
        TRY_CAST(AGE AS INTEGER) AS age,
        AGENAME AS age_name,
        TRY_CAST(SEX AS INTEGER) AS sex,
        SEXNAME AS sex_name,
        TRY_CAST(PER_TYP AS INTEGER) AS per_typ,
        PER_TYPNAME AS per_typ_name,
        TRY_CAST(INJ_SEV AS INTEGER) AS inj_sev,
        INJ_SEVNAME AS inj_sev_name,
        TRY_CAST(SEAT_POS AS INTEGER) AS seat_pos,
        SEAT_POSNAME AS seat_pos_name,
        TRY_CAST(REST_USE AS INTEGER) AS rest_use,
        REST_USENAME AS rest_use_name,
        TRY_CAST(REST_MIS AS INTEGER) AS rest_mis,
        REST_MISNAME AS rest_mis_name,
        TRY_CAST(HELM_USE AS INTEGER) AS helm_use,
        HELM_USENAME AS helm_use_name,
        TRY_CAST(HELM_MIS AS INTEGER) AS helm_mis,
        HELM_MISNAME AS helm_mis_name,
        TRY_CAST(AIR_BAG AS INTEGER) AS air_bag,
        AIR_BAGNAME AS air_bag_name,
        TRY_CAST(EJECTION AS INTEGER) AS ejection,
        EJECTIONNAME AS ejection_name,
        TRY_CAST(EJ_PATH AS INTEGER) AS ej_path,
        EJ_PATHNAME AS ej_path_name,
        TRY_CAST(EXTRICAT AS INTEGER) AS extricat,
        EXTRICATNAME AS extricat_name,
        TRY_CAST(DRINKING AS INTEGER) AS drinking,
        DRINKINGNAME AS drinking_name,
        TRY_CAST(ALC_STATUS AS INTEGER) AS alc_status,
        ALC_STATUSNAME AS alc_status_name,
        TRY_CAST(ATST_TYP AS INTEGER) AS atst_typ,
        ATST_TYPNAME AS atst_typ_name,
        TRY_CAST(ALC_RES AS INTEGER) AS alc_res,
        ALC_RESNAME AS alc_res_name,
        TRY_CAST(DRUGS AS INTEGER) AS drugs,
        DRUGSNAME AS drugs_name,
        TRY_CAST(DSTATUS AS INTEGER) AS dstatus,
        DSTATUSNAME AS dstatus_name,
        TRY_CAST(HOSPITAL AS INTEGER) AS hospital,
        HOSPITALNAME AS hospital_name,
        TRY_CAST(DOA AS INTEGER) AS doa,
        DOANAME AS doa_name,
        TRY_CAST(DEATH_MO AS INTEGER) AS death_mo,
        DEATH_MONAME AS death_mo_name,
        TRY_CAST(DEATH_DA AS INTEGER) AS death_da,
        DEATH_DANAME AS death_da_name,
        TRY_CAST(DEATH_YR AS INTEGER) AS death_yr,
        DEATH_YRNAME AS death_yr_name,
        TRY_CAST(DEATH_TM AS INTEGER) AS death_tm,
        DEATH_TMNAME AS death_tm_name,
        TRY_CAST(DEATH_HR AS INTEGER) AS death_hr,
        DEATH_HRNAME AS death_hr_name,
        TRY_CAST(DEATH_MN AS INTEGER) AS death_mn,
        DEATH_MNNAME AS death_mn_name,
        TRY_CAST(LAG_HRS AS INTEGER) AS lag_hrs,
        LAG_HRSNAME AS lag_hrs_name,
        TRY_CAST(LAG_MINS AS INTEGER) AS lag_mins,
        LAG_MINSNAME AS lag_mins_name,
        TRY_CAST(STR_VEH AS INTEGER) AS str_veh,
        DEVTYPE AS devtype,
        DEVTYPENAME AS devtype_name,
        DEVMOTOR AS devmotor,
        DEVMOTORNAME AS devmotor_name,
        LOCATION AS location,
        LOCATIONNAME AS location_name,
        TRY_CAST(WORK_INJ AS INTEGER) AS work_inj,
        WORK_INJNAME AS work_inj_name,
        TRY_CAST(HISPANIC AS INTEGER) AS hispanic,
        HISPANICNAME AS hispanic_name
FROM bronze.bronze_person
WHERE ST_CASE IS NOT NULL AND VEH_NO IS NOT NULL AND PER_NO IS NOT NULL
    AND NOT EXISTS (
            SELECT 1 FROM analysis.silver_person s
            WHERE s.st_case = TRY_CAST(bronze.bronze_person.ST_CASE AS INTEGER)
                AND s.veh_no = TRY_CAST(bronze.bronze_person.VEH_NO AS INTEGER)
                AND s.per_no = TRY_CAST(bronze.bronze_person.PER_NO AS INTEGER)
    );